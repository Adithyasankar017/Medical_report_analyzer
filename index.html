<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Medical Report Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ‚úÖ CORRECT CSS PATH -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <!-- TOP BAR -->
  <div class="top-bar">
    <h2>Medical Report Analyzer</h2>

    <div class="location-select">
      <select id="citySelect">
        <option value="">Select City</option>
        <option value="Trivandrum">Trivandrum</option>
        <option value="Kochi">Kochi</option>
      </select>
    </div>
  </div>

  <!-- HERO SECTION -->
  <section class="hero">

    <!-- LEFT SIDE -->
    <div class="hero-left">

      <h1>Understand Medical Reports<br>with Confidence</h1>

      <p>
        Upload your medical report and get a simple,
        human-friendly explanation before visiting a doctor.
      </p>

      <!-- LANGUAGE -->
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="ml">Malayalam</option>
      </select>

      <!-- PATIENT INFO -->
      <div class="patient-info">
        <input type="number" id="ageInput" placeholder="Age" min="1" max="120">
        <select id="sexSelect">
          <option value="">Select Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
      </div>

      <!-- UPLOAD BOX -->
      <div class="upload-box">
        <label><strong>Upload Medical Report</strong></label><br>
        <input type="file" id="reportUpload" accept=".pdf,.jpg,.jpeg,.png">
        <p id="uploadStatus"></p>

        <p>Supported formats: PDF, JPG, PNG</p>
      </div>

      <!-- BUTTON -->
      <button class="analyze-btn" onclick="analyzeReport()">
        Analyze Report
      </button>

      <!-- STATS -->
      <div class="stats">
        <div><strong>100+</strong><br>Tests Explained</div>
        <div><strong>Live</strong><br>Hospital Data</div>
        <div><strong>Malayalam</strong><br>Support</div>
      </div>

    </div>

    <!-- RIGHT SIDE IMAGE -->
    <div class="hero-right">
      <!-- ‚úÖ CORRECT IMAGE PATH -->
      <img src="C:\Users\Admin\Desktop\medical-report-analyzer-frontend\doctors.jpg" alt="Doctors">
    </div>

  </section>

  <!-- INFO BUTTONS -->
  <div class="info-buttons">
    <a href="doctors.html" class="info-card">Doctors</a>
    <a href="hospitals.html" class="info-card">Hospitals</a>
    <a href="labs.html" class="info-card">Labs</a>
    <a href="tests.html" class="info-card">Tests</a>
  </div>

  <!-- FOOTER -->
  <footer>
    ¬© 2026 Medical Report Analyzer
  </footer>

  <!-- ================= CITY SELECTION ================= -->
  <script>
    const citySelect = document.getElementById("citySelect");

    const savedCity = localStorage.getItem("selectedCity");
    if (savedCity) {
      citySelect.value = savedCity;
    }

    citySelect.addEventListener("change", () => {
      const city = citySelect.value;
      if (city) {
        localStorage.setItem("selectedCity", city);
      } else {
        localStorage.removeItem("selectedCity");
      }
    });
  </script>

  <!-- ================= REPORT ANALYZER ================= -->
  <script>
    async function analyzeReport() {

      const fileInput = document.getElementById("reportUpload");
      const file = fileInput.files[0];

      if (!file) {
        alert("Please upload a medical report first.");
        return;
      }

      const age = document.getElementById("ageInput").value;
      const sex = document.getElementById("sexSelect").value;
      const lang = document.getElementById("languageSelect").value || "en";

      const formData = new FormData();
      formData.append("file", file);
      if (age) formData.append("age", age);
      if (sex) formData.append("sex", sex);
      formData.append("lang", lang);

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "<p style='text-align: center; font-size: 18px;'>üè• Analyzing report... Please wait ‚è≥</p>";

      try {

        const response = await fetch("http://localhost:5000/api/analyze", {
          method: "POST",
          body: formData
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || "Server error");
        }

        const data = await response.json();
        
        if (data.message) {
          resultDiv.innerHTML = "<p style='text-align: center; font-size: 16px;'>" + data.message + "</p>";
          return;
        }

        displayResults(data.detectedParameters || []);

      } catch (error) {
        resultDiv.innerHTML = "<p style='color: red; text-align: center;'><strong>Error:</strong> " + error.message + "</p>";
        console.error(error);
      }
    }

    function displayResults(results) {

      const resultDiv = document.getElementById("result");

      if (!results || results.length === 0) {
        resultDiv.innerHTML = "<p style='text-align: center;'>No medical parameters detected.</p>";
        return;
      }

      let html = "<h2>üìä Analysis Results</h2>";

      results.forEach(item => {

        let statusColor = "#27ae60"; // Green for Normal
        let statusEmoji = "‚úÖ";
        
        if (item.status === "Low") {
          statusColor = "#f39c12"; // Orange/Amber
          statusEmoji = "‚¨áÔ∏è";
        } else if (item.status === "High") {
          statusColor = "#e74c3c"; // Red
          statusEmoji = "‚¨ÜÔ∏è";
        }

        html += `
          <div class="result-card" style="border-left: 5px solid ${statusColor};">
            <h3>${item.name.replace(/_/g, ' ').toUpperCase()}</h3>
            <p><strong>Value:</strong> ${item.value} ${item.unit || ""}</p>
            <p><strong>Normal Range:</strong> ${item.normalRange}</p>
            <p><strong>Status:</strong> 
              <span style="color:${statusColor}; font-weight:bold;">
                ${statusEmoji} ${item.status}
              </span>
            </p>
            <p style="background-color: #f8f9fa; padding: 12px; border-radius: 5px; margin: 10px 0;">
              <strong>Explanation:</strong><br>${item.explanation}
            </p>
            <p class="disclaimer" style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">
              ‚ö†Ô∏è This analysis is AI-generated and not a substitute for professional medical diagnosis. Always consult your healthcare provider.
            </p>
          </div>
        `;
      });

      resultDiv.innerHTML = html;
    }
  </script>

</body>
</html>